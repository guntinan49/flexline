<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LIFF Share Preview</title>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #eef2ff;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ===== MODAL ===== */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal {
      background: #fff;
      width: 88%;
      max-width: 360px;
      border-radius: 22px;
      padding: 20px;
      text-align: center;
      animation: pop .25s ease;
    }

    .modal img {
      width: 100%;
      border-radius: 16px;
      margin-bottom: 12px;
    }

    .modal h2 {
      margin: 8px 0 4px;
    }

    .modal p {
      font-size: 14px;
      color: #666;
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    .actions button {
      flex: 1;
      padding: 12px;
      border-radius: 14px;
      border: none;
      font-size: 15px;
    }

    .cancel {
      background: #eee;
    }

    .share {
      background: #06c755;
      color: white;
    }

    @keyframes pop {
      from { transform: scale(.9); opacity: 0 }
      to { transform: scale(1); opacity: 1 }
    }

    .msg {
      display: none;
      background: #fff;
      padding: 20px 30px;
      border-radius: 16px;
      font-size: 18px;
      text-align: center;
    }
  </style>
</head>

<body>

  <!-- PRE SHARE MODAL -->
  <div class="overlay" id="shareModal" style="display:none">
    <div class="modal">
      <img src="https://img5.pic.in.th/file/secure-sv1/ezgif.com-gif-to-apng-converter70850b2b0c3a2b52.gif">
      <h2>üìö ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô</h2>
      <p>‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡πÜ ‡πÉ‡∏ô LINE ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>

      <div class="actions">
        <button class="cancel" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="share" onclick="startShare()">‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏•‡∏¢</button>
      </div>
    </div>
  </div>

  <!-- STATUS -->
  <div class="msg" id="loadingMsg">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‚Ä¶</div>
  <div class="msg" id="successMsg">‚úÖ ‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
  <div class="msg" id="errorMsg">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</div>

<script>
  function show(id) {
    document.querySelectorAll(".msg").forEach(el => el.style.display = "none");
    document.getElementById(id).style.display = "block";
  }

  function openModal() {
    document.getElementById("shareModal").style.display = "flex";
  }

  function closeModal() {
    liff.closeWindow();
  }

  const flexMessage = {
    type: "flex",
    altText: "üìö ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô",
    contents: {
      type: "carousel",
      contents: [
        {
          type: "bubble",
          hero: {
            type: "image",
            url: "https://img5.pic.in.th/file/secure-sv1/ezgif.com-gif-to-apng-converter70850b2b0c3a2b52.gif",
            size: "full",
            aspectMode: "cover",
            aspectRatio: "2.3:3",
            action: {
              type: "uri",
              uri: "https://liff.line.me/2008871423-5XU3Fbat"
            }
          }
        }
      ]
    }
  };

  async function startShare() {
    document.getElementById("shareModal").style.display = "none";
    const result = await liff.shareTargetPicker([flexMessage]);
    if (result) {
      show("successMsg");
      setTimeout(() => liff.closeWindow(), 1500);
    } else {
      liff.closeWindow();
    }
  }

  async function main() {
    try {
      show("loadingMsg");
      await liff.init({ liffId: "2008871423-5XU3Fbat" });

      if (!liff.isInClient()) {
        throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ LINE");
      }

      document.getElementById("loadingMsg").style.display = "none";
      openModal();

    } catch (e) {
      document.getElementById("errorMsg").innerText = "‚ùå " + e.message;
      show("errorMsg");
    }
  }

  main();
</script>

</body>
</html>
