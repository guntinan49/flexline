<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LIFF Share</title>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
:root{
  --bg:#f4f5f9;
  --text:#111;
  --glass:rgba(0,0,0,.08);
  --card:#fff;
}

[data-theme="dark"]{
  --bg:#0b0b0d;
  --text:#fff;
  --glass:rgba(255,255,255,.14);
  --card:#141417;
}

*{box-sizing:border-box;font-family:system-ui,-apple-system}

body{
  margin:0;
  height:100vh;
  background:var(--bg);
  color:var(--text);
  display:flex;
  align-items:center;
  justify-content:center;
  transition:.3s;
}

/* UI */
#app{
  width:100%;
  max-width:420px;
  padding:20px;
}

.card{
  background:var(--card);
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 20px 50px rgba(0,0,0,.3);
}

.card img{
  width:100%;
  display:block;
}

.content{
  padding:14px;
}

.btn{
  width:100%;
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:16px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}

.primary{
  background:#06c755;
  color:#000;
}

.secondary{
  background:var(--glass);
  color:var(--text);
}

/* status */
#status{
  text-align:center;
  opacity:.7;
  font-size:14px;
}

/* theme btn */
#themeBtn{
  position:fixed;
  top:14px;
  right:14px;
  border:none;
  background:var(--glass);
  padding:10px 12px;
  border-radius:14px;
  cursor:pointer;
}
</style>
</head>

<body>

<button id="themeBtn">üåô</button>

<div id="app">
  <div class="card">
    <img src="https://img5.pic.in.th/file/secure-sv1/ezgif.com-gif-to-apng-converter70850b2b0c3a2b52.gif">
    <div class="content">
      <b>üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô</b>
      <div style="font-size:14px;opacity:.7">‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏ô LINE</div>
    </div>
  </div>

  <button class="btn primary" id="shareBtn">‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏õ LINE</button>
  <button class="btn secondary" onclick="liff.closeWindow()">‡∏õ‡∏¥‡∏î</button>

  <div id="status">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö‚Ä¶</div>
</div>

<script>
/* ================= THEME ================= */
const media = window.matchMedia('(prefers-color-scheme: dark)');
const themeBtn = document.getElementById("themeBtn");

function applyTheme(t){
  document.documentElement.setAttribute("data-theme",t);
  themeBtn.textContent = t === "dark" ? "‚òÄÔ∏è" : "üåô";
}

function initTheme(){
  const saved = localStorage.getItem("theme");
  if(saved){
    applyTheme(saved);
  }else{
    applyTheme(media.matches ? "dark" : "light");
  }
}

themeBtn.onclick = ()=>{
  const now = document.documentElement.getAttribute("data-theme");
  const next = now === "dark" ? "light" : "dark";
  localStorage.setItem("theme",next);
  applyTheme(next);
};

media.addEventListener("change",e=>{
  if(!localStorage.getItem("theme")){
    applyTheme(e.matches ? "dark" : "light");
  }
});

initTheme();

/* ================= LIFF ================= */
let liffReady = false;
const status = document.getElementById("status");
const shareBtn = document.getElementById("shareBtn");

const flexMessage = {
  type:"flex",
  altText:"üìö ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô",
  contents:{
    type:"bubble",
    body:{
      type:"box",
      layout:"vertical",
      contents:[
        {
          type:"image",
          url:"https://img5.pic.in.th/file/secure-sv1/ezgif.com-gif-to-apng-converter70850b2b0c3a2b52.gif",
          size:"full",
          aspectRatio:"2:3",
          aspectMode:"cover"
        }
      ]
    }
  }
};

async function initLIFF(){
  try{
    await Promise.race([
      liff.init({ liffId:"YOUR_LIFF_ID" }),
      new Promise((_,r)=>setTimeout(()=>r(new Error("timeout")),3000))
    ]);

    if(!liff.isInClient()){
      status.textContent = "‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ LINE";
      shareBtn.disabled = true;
      return;
    }

    liffReady = true;
    status.textContent = "‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß";

  }catch(e){
    status.textContent = "‚ùå ‡πÄ‡∏õ‡∏¥‡∏î LIFF ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
    console.error(e);
  }
}

shareBtn.onclick = async ()=>{
  if(!liffReady){
    alert("‚è≥ ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°");
    return;
  }

  shareBtn.disabled = true;
  status.textContent = "üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏ä‡∏£‡πå‚Ä¶";

  try{
    const res = await liff.shareTargetPicker([flexMessage]);
    if(res){
      status.textContent = "‚úÖ ‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
      setTimeout(()=>liff.closeWindow(),1200);
    }else{
      status.textContent = "‚ÑπÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå";
      shareBtn.disabled = false;
    }
  }catch(e){
    alert("‚ùå ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    console.error(e);
    shareBtn.disabled = false;
    status.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î";
  }
};

initLIFF();
</script>

</body>
</html>
